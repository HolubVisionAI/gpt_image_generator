# GPT Image Generator

A Flask-based API that accepts a base64 image and prompt, then uses a headless browser to interact with the GPT-based image generation UI. The generated image is returned in base64 format.

## ? Environment Setup

### ? Python Version
This project uses **Python 3.10**
If the os is not ubuntu22.04, install python 3.10.
```bash
sudo apt update
sudo apt install software-properties-common -y
sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt update
sudo apt install python3.10 -y
sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.10 1
sudo update-alternatives --config python3

sudo apt install python3.10-distutils -y
curl -sS https://bootstrap.pypa.io/get-pip.py | sudo python3.10
sudo apt install python3.10-venv -y
````

### ? Setup Virtual Environment

```bash
sudo apt install python3-pip -y
python3 -m venv venv10
source venv10/bin/activate   # On Windows use: venv10\Scripts\activate
```

### ? Install Requirements

```bash
pip3 install -r ./requirements/base.txt
```

### ? Install Google Chrome

Required for running the image generator that uses headless browser automation.

```bash
wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
sudo apt install ./google-chrome-stable_current_amd64.deb -y
#UI test by vnc(optional)
google-chrome --no-sandbox # test
```
### ? Install Dependencies

If the credential information is changed, a re-login through VNC is required because bypassing the login section is not feasible. Once logged in, the script can run successfully. However, the script does not work in headless mode.

install VNC and wmctrl in the VPS
```bash
# install wmctrl (this is for closing Open Files dialog)
sudo apt-get install wmctrl
# isntall VNC
sudo apt install xfce4 xfce4-goodies tightvncserver -y
# run server
vncserver :1
```
in client
```bash
# install vnc
sudo apt install xfce4 xfce4-goodies tightvncserver -y
# connect vps
ssh -L 5901:127.0.0.1:5901 root@<ip-address>
localhost:1
```

---

## ?? Configuration

Edit the `config.yaml` file in the root directory:

```yaml
token:
  - "your-secret-token"

email:
  - "your-gpt-email@example.com"

password:
  - "your-gpt-password"

chatgpt_url:
  - "https://chat.openai.com"
# The image requested from the API will be saved in this directory
uploaded_dir:
  - "uploads"
# The image generated by GPT be saved in this directory
download_dir:
  - "downloads" 
```

---

## ? Run the API Server

```bash
python3 app.py
```

Server will start on `http://127.0.0.1:80`

---

## ? API Endpoint

### `POST /trigger`

Trigger the image generation process.

#### ? Headers

- `Authorization: Bearer <your-secret-token>`

#### ? Request JSON

```json
{
  "image": "<base64-encoded-image>",
  "prompt": "Describe what to generate"
}
```

#### ? Response (Success)

```json
{
  "status": "success",
  "message": "Image is generated from GPT UI",
  "image": "<base64-encoded-generated-image>"
}
```

#### ? Response (Errors)

- 401 Unauthorized ? Invalid token
- 400 Bad Request ? Missing prompt or image
- 500 Server Error ? Internal failure during generation

---

## ? Project Structure

```
.
??? main.py                  # Flask API entry point
??? settings.py              # Defines SCRIPT_DIR
??? config.yaml              # Config file for credentials and directories
??? requirements/
?   ??? base.txt             # Python dependencies
??? src/
?   ??? image_generator.py   # GPTImageGenerator class (browser-based)
?   ??? utils.py             # Utility functions (logging, config loading)
??? uploads/                 # Uploaded images (created at runtime)
??? downloads/               # Generated images (created at runtime)
```

---

## ? GPT Image Generation

The image generation works by automating browser actions to interact with the ChatGPT image generation UI using the credentials provided in `config.yaml`.
In these cases, the reqeust is failed.
1. In some cases, GPT says like this: 'I couldn't generate a "Muppet version" of the car image because that request violates our content policies. If you like, you can suggest a different idea! For example, I could create a cartoon-style version of the car, a fantasy-styled vehicle, or something else fun. What would you like to do?'
2. GPT may provide two different responses, and the download button sometimes behaves irregularly.

---

